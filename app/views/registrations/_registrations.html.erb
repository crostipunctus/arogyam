<%= turbo_frame_tag "registrations_table" do %>
  <table class="registration-table">
    <thead>
      <tr>
        <th>Full Name</th>
        <th>Email</th>
        <th>Programme</th>
        <th>Batch</th>
        <th>Status</th>
        <th>Comments</th>
        <th>Actions</th> 
      </tr>
    </thead>
    <tbody>
      <% if @registrations.exists? %>
        <% @registrations.each do |registration|%>
            <tr style="<%= 'background-color: #FFCCCC;' if registration.status == 'Cancelled' %>">
              <td data-th="Full Name"><%= link_to user_full_name(registration.user), user_profile_path(user_id: registration.user.id), class: "nav-link" %></td>
              <td data-th="Email"><%= registration.user.email %></td>
              <td data-th="Programme"><%= registration.package.name %></td>
              <td data-th="Batch"><%= formatted_date(registration.batch.start_date) %></td>
              <td data-th="Status" data-controller="status" data-status-endpoint-value="<%= registration_path(registration) %>">            
                <span data-status-target="status"><%= registration.status %></span>
                <% if registration.status != 'Cancelled' %>
                    <%= link_to 'Edit', '#', class: 'btn btn-outline-success btn-sm', data: { action: 'click->status#toggleEditMode', status_target: 'edit' } %>
                <% else %>
                    <!-- No action for Cancelled status -->
                <% end %>
                <div data-status-target="editMode" style="display:none;">
                    <%= form_with url: registration_path(registration), method: :patch, remote: true, html: { controller: 'status', data: { action: 'submit->status#save' } } do |f| %>
                      <%= f.select :status, [ ['Completed'], ['Payment Completed'], ['Payment Pending']], {}, { class: 'form-control', data: { status_target: 'statusSelect' } } %>
                      <%= f.submit 'Save', class: 'btn btn-outline-primary btn-sm' %>
                    <% end %>
                    <%= link_to 'Cancel', '#', class: 'btn btn-outline-secondary btn-sm', data: { action: 'click->status#cancel', status_target: 'cancel' } %>
                </div>
              </td>
             
                <td data-th="Comments" data-controller="expand">
                  <span data-expand-target="content" data-full="<%= registration.comments %>">
                      <%= truncate(registration.comments, length: 50) %>
                  </span>
                  
                  <% if registration.comments && registration.comments.length > 50 %>
                      <button class="btn btn-outline-info btn-sm expand-btn" data-action="click->expand#expand">Expand</button>
                  <% end %>

                  <%= link_to "Edit", edit_registration_path(registration), class: 'btn btn-outline-success btn-sm'%>
              </td>




              <td data-th="Actions">
                <%= link_to 'View', registration_path(registration), class: 'btn btn-outline-success btn-sm' %>
                <% if registration.completed == false %>
                  <span><%= button_to 'Cancel', registration_path(registration), method: :delete, form: { data: { 'turbo-confirm': 'Are you sure?' } }, class: 'btn btn-outline-danger btn-sm' %></span>
                <% end %>
              </td>
            </tr>
        <% end %>
      <% else %>
        <tr>
          <td colspan="6" style="text-align: center;">No registrations found.</td>
        </tr>
      <% end %>
    </tbody>
  </table>
  <div class="pagination-wrapper">
    <%= paginate @registrations, data: { turbo_frame: 'registrations_table' } %>
  </div>
<% end %>